<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dev-UI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="./assets/three.min.js" defer></script>
    <script src="script.js" defer></script>
</head>
<body>
    <div class="loading-text"></div>
    <div class="middle-logo">
        <span class="main-span"><span>eDev-UI</span></span>
    </div>
    <div class="dashboard" style="display: none;">
        <div class="top-nav">
            <div id="left-box-top" class="end-lines top_nav_item">
                <span>PANEL</span>
                <span>SYSTEM</span>
            </div>
            <div id="middle-box-top" class="end-lines top_nav_item">
                <span>TERMINAL</span>
                <span>MAIN SHELL</span>
            </div>
            <div id="right-box-top" class="end-lines top_nav_item">
                <span>PANEL</span>
                <span>NETWORK</span>
            </div>
        </div>
        <div class="top">
            <div class="left-box">
                <div id="time">
                    <span id="hours"></span>
                    <span>:</span>
                    <span id="minutes"></span>
                    <span>:</span>
                    <span id="seconds"></span>
                </div>
                <div class="basics">
                    <div>
                        <span id="year" class="grayed"></span>
                        <span id="month-day"></span>
                    </div>
                    <div>
                        <span class="grayed">UPTIME</span>
                        <span id="uptime"></span>
                    </div>
                    <div>
                        <span class="grayed">TYPE</span>
                        <span id="os"></span>
                    </div>
                    <div>
                        <span class="grayed">POWER</span>
                        <span id="battery"></span>
                    </div>
                </div>
                <div class="basics" style="justify-content: flex-start; padding-left: 1rem;">
                    <div style="margin-right: 1rem;">
                        <span>MANAFACTURER</span>
                        <span id="manafacturer" class="grayed">N/A</span>
                    </div>
                    <div style="margin-right: 1rem;">
                        <span>MODEL</span>
                        <span id="model" class="grayed">N/A</span>
                    </div>
                    <div>
                        <span>CHASSIS</span>
                        <span id="chassis" class="grayed">N/A</span>
                    </div>
                </div>
                <div class="cpu">
                    <div class="cpu-top">
                        <span>CPU USAGE</span>
                        <span class="grayed">CPU N/A</span>
                    </div>
                    <div class="cpu-graph">
                        <div class="cpu-top-graph" style="margin-bottom: 1rem;">
                            <div class="cpu-graph-text flex-column">
                                <span># 1 - 2</span>
                                <span class="grayed">Avg. N/A%</span>
                            </div>
                            <canvas id="fakeGraph" width="250" height="50"></canvas>
                        </div>
                        <div class="cpu-bottom-graph">
                            <div class="cpu-graph-text flex-column">
                                <span># 3 - 4</span>
                                <span class="grayed">Avg. N/A%</span>
                            </div>
                            <canvas id="fakeGraph" width="250" height="50"></canvas>
                        </div>
                    </div>
                    <div class="cpu-details">
                        <div>
                            <span>TEMP</span>
                            <span class="grayed">N/A&deg;C</span>
                        </div>
                        <div>
                            <span>MIN</span>
                            <span class="grayed">N/AGhz</span>
                        </div>
                        <div>
                            <span>MAX</span>
                            <span class="grayed">N/AGhz</span>
                        </div>
                        <div>
                            <span>TASKS</span>
                            <span class="grayed">N/A</span>
                        </div>
                    </div>
                </div>
                <div class="memory">
                    <div class="memory-top">
                        <span>MEMORY</span>
                        <span class="grayed">USING N/A OUT OF N/A GIB</span>
                    </div>
                    <div class="dot-grid">
                        <div class="fake-memory-dots">
                            <div class="fake_dot_col"></div>
                            <div class="fake_dot_col"></div>
                            <div class="fake_dot_col"></div>
                            <div class="fake_dot_col"></div>
                            <div class="fake_dot_col"></div>
                            <div class="fake_dot_col"></div>
                            <div class="fake_dot_col"></div>
                            <div class="fake_dot_col"></div>
                            <div class="fake_dot_col"></div>
                            <div class="fake_dot_col"></div>
                            <div class="fake_dot_col"></div>
                        </div>
                    </div>
                    <div class="memory-bottom" style="margin-top: 0.5rem;">
                        <span>SWAP</span>
                        <span class="grayed">N/A GIB</span>
                    </div>
                </div>
            </div>
            <div class="middle-box"></div>
            <div class="right-box">
                <div class="network-status">
                    <div class="network-status-top">
                        <span>NETWORK STATUS</span>
                        <span class="grayed font-small">Interface: N/A</span>
                    </div>
                    <div class="network-top-details">
                        <div class="flex-column">
                            <span class="grayed">STATE</span>
                            <span id="user-online-state"></span>
                        </div>
                        <div class="flex-column">
                            <span class="grayed" id="user-ip-type">IPv4</span>
                            <span id="user-ip"></span>
                        </div>
                        <div class="flex-column">
                            <span class="grayed">PING</span>
                            <span id="user-ping"></span>
                        </div>
                    </div>
                </div>
                <div class="world-location">
                    <div class="world-location-top">
                        <span>WORLD VIEW</span>
                        <span class="grayed font-small">GLOBAL NETWORK MAP</span>
                    </div>
                    <div class="world-location-top">
                        <span class="grayed">ENDPOINT LAT/LON</span>
                        <span class="font-small" id="lat-lon" style="color: rgb(90, 90, 90)">N/A, N/A</span>
                    </div>
                    <div id="earth-container"></div>
                </div>
            </div>
        </div>
        <div class="bottom">
            <div class="bottom-left"></div>
            <div class="bottom-right">
                <div class="row-1">
                    <!-- <span>ESC</span> -->
                </div>
                <div class="row-2"></div>
                <div class="row-3"></div>
                <div class="row-4"></div>
                <div class="row-5"></div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function(){
            const container = document.getElementById("earth-container");
            const earth_width = 400;
            const earth_height = 450;

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(70, earth_width/earth_height, 0.1, 1000);
            camera.position.z = 3;

            const renderer = new THREE.WebGLRenderer({antialias: true});
            renderer.setSize(earth_width, earth_height);
            renderer.setClearColor(0x000000, 0);
            container.appendChild(renderer.domElement);

            const loader = new THREE.TextureLoader();
            loader.load("./assets/earth.jpg", texture => {
                const size = 256;
                const canvas = document.createElement("canvas");
                canvas.width = canvas.height = size;
                const ctx = canvas.getContext("2d");
                ctx.drawImage(texture.image, 0, 0, size, size);
                const imgData = ctx.getImageData(0, 0, size, size).data;

                // Create a group to hold globe and markers
                const globeGroup = new THREE.Group();
                scene.add(globeGroup);

                // Globe points
                const positions = [];
                for (let y = 0; y < size; y += 2) {
                    for (let x = 0; x < size; x += 2) {
                        const i = (y * size + x) * 4;
                        const r = imgData[i], g = imgData[i+1], b = imgData[i+2];
                        if (!(b > r && b > g)) {
                            const lon = -((x / size) * Math.PI * 2 - Math.PI);
                            const lat = (1 - y / size) * Math.PI - Math.PI / 2;
                            const radius = 1;

                            const px = radius * Math.cos(lat) * Math.cos(lon);
                            const py = radius * Math.sin(lat);
                            const pz = radius * Math.cos(lat) * Math.sin(lon);
                            positions.push(px, py, pz);
                        }
                    }
                }

                const geometry = new THREE.BufferGeometry();
                geometry.setAttribute("position", new THREE.Float32BufferAttribute(positions, 3));
                const material = new THREE.PointsMaterial({ color: "white", size: 0.004 });
                const points = new THREE.Points(geometry, material);
                globeGroup.add(points);

                // User location marker
                if ("geolocation" in navigator) {
                    navigator.geolocation.getCurrentPosition(position => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;

                        const radius = 1.02; // slightly above globe
                        const phi = (90 - lat) * (Math.PI / 180);
                        const theta = -(lon * (Math.PI / 180));
                        
                        const x = radius * Math.sin(phi) * Math.cos(theta);
                        const y = radius * Math.cos(phi);
                        const z = radius * Math.sin(phi) * Math.sin(theta);

                        const markerGeo = new THREE.SphereGeometry(0.02, 8, 8);
                        const markerMat = new THREE.MeshBasicMaterial({ color: 0xff0000 });
                        const marker = new THREE.Mesh(markerGeo, markerMat);
                        marker.position.set(x, y, z);
                        globeGroup.add(marker);

                        // Rotate globe so marker is at front
                        globeGroup.rotation.y = -theta + Math.PI; // front-facing
                    });
                }

                // Animate
                function animate() {
                    requestAnimationFrame(animate);
                    globeGroup.rotation.y += 0.004;
                    renderer.render(scene, camera);
                }
                animate();
            });

            window.addEventListener("resize", () => {
                camera.aspect = earth_width / earth_height;
                camera.updateProjectionMatrix();
                renderer.setSize(earth_width, earth_height);
            });
        });
  </script>
</body>
</html>